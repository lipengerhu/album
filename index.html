// 修改 formatAddress 函数
formatAddress: function(location) {
  if (!location) return '未知位置';
  
  console.log('location 对象:', location);
  
  // 直接访问 location 对象的字段
  if (location.formatted_address) {
    console.log('使用 formatted_address:', location.formatted_address);
    return location.formatted_address;
  }
  
  if (location.address) {
    console.log('使用 address:', location.address);
    return location.address;
  }
  
  // 如果都没有，拼接省市区
  const { province, city, district } = location;
  if (province || city || district) {
    const address = [province, city, district].filter(Boolean).join('');
    console.log('拼接的地址:', address);
    return address;
  }
  
  return '未知位置';
},

// 修改 processPhotos 函数，确保正确传递 location
processPhotos(photos, title) {
  if (photos && photos.length > 0) {
    console.log('原始照片数据样例:', photos[0]);
    
    const processedPhotos = photos.map(photo => {
      const displayAddress = this.formatAddress(photo.location);
      
      console.log('处理后的照片:', {
        fileID: photo.fileID,
        location: photo.location,
        displayAddress: displayAddress
      });
      
      return {
        _id: photo._id,
        fileID: photo.fileID,
        earliestTime: photo.earliestTime,
        uploadTime: photo.uploadTime,
        location: photo.location, // 直接使用 photo.location
        timestamp: photo.earliestTime ? new Date(photo.earliestTime).getTime() : 
                  (photo.uploadTime ? new Date(photo.uploadTime).getTime() : Date.now()),
        displayAddress: displayAddress,
        selected: false
      };
    });

    this.setData({
      photos: processedPhotos,
      title: title,
      loading: false,
      hasData: true,
      selectMode: false,
      selectedPhotos: [],
      allSelected: false
    });
    
    // 检查设置后的数据
    console.log('设置到页面的照片数据:', this.data.photos);
    
  } else {
    this.showEmptyState();
  }
},
